// Simplified country bounding boxes for offline reverse geocoding
// Data derived from OpenStreetMap, licensed under ODbL
// Format: [minLat, minLon, maxLat, maxLon]

class CountryBounds {
  static const Map<String, List<double>> bounds = {
    // Europe
    'RU': [41.185, 19.25, 81.858, 180.0], // Russia
    'NO': [57.977, 4.65, 71.185, 31.293], // Norway
    'SE': [55.337, 11.118, 69.06, 24.166], // Sweden
    'FI': [59.809, 20.645, 70.092, 31.587], // Finland
    'ES': [27.638, -18.161, 43.791, 4.327], // Spain
    'FR': [41.333, -5.225, 51.124, 9.662], // France
    'DE': [47.270, 5.866, 55.099, 15.042], // Germany
    'PL': [49.002, 14.123, 54.836, 24.146], // Poland
    'IT': [35.493, 6.627, 47.092, 18.520], // Italy
    'GB': [49.864, -8.649, 60.861, 1.768], // United Kingdom
    'IE': [51.445, -10.478, 55.388, -5.993], // Ireland
    'PT': [29.825, -31.266, 42.154, -6.190], // Portugal
    'GR': [34.802, 19.375, 41.749, 29.647], // Greece
    'UA': [44.386, 22.137, 52.379, 40.228], // Ukraine
    'TR': [35.815, 25.664, 42.107, 44.835], // Turkey
    'NL': [50.750, 3.358, 53.555, 7.227], // Netherlands
    'BE': [49.497, 2.546, 51.505, 6.408], // Belgium
    'CH': [45.818, 5.956, 47.808, 10.492], // Switzerland
    'AT': [46.372, 9.531, 49.020, 17.161], // Austria
    'CZ': [48.551, 12.091, 51.055, 18.860], // Czech Republic
    'RO': [43.619, 20.262, 48.266, 29.749], // Romania
    'BG': [41.235, 22.357, 44.216, 28.612], // Bulgaria
    'HU': [45.737, 16.113, 48.585, 22.898], // Hungary
    'RS': [42.232, 18.817, 46.190, 23.006], // Serbia
    'HR': [42.389, 13.493, 46.555, 19.427], // Croatia
    'DK': [54.562, 8.075, 57.752, 15.198], // Denmark
    'SK': [47.731, 16.834, 49.614, 22.558], // Slovakia
    'LT': [53.897, 20.942, 56.450, 26.836], // Lithuania
    'LV': [55.675, 20.968, 58.086, 28.241], // Latvia
    'EE': [57.516, 21.839, 59.676, 28.210], // Estonia
    'SI': [45.421, 13.375, 46.877, 16.611], // Slovenia
    'BY': [51.262, 23.176, 56.172, 32.776], // Belarus
    'AL': [39.645, 19.293, 42.665, 21.068], // Albania
    'MK': [40.860, 20.464, 42.361, 23.034], // North Macedonia
    'BA': [42.546, 15.718, 45.277, 19.622], // Bosnia and Herzegovina
    'ME': [41.850, 18.461, 43.558, 20.358], // Montenegro
    'LU': [49.447, 5.735, 50.183, 6.531], // Luxembourg
    'IS': [63.393, -24.546, 66.538, -13.496], // Iceland

    // Asia
    'CN': [18.197, 73.557, 53.561, 134.773], // China
    'IN': [6.747, 68.176, 35.674, 97.403], // India
    'ID': [-11.005, 95.009, 6.077, 141.020], // Indonesia
    'JP': [24.045, 122.934, 45.523, 153.987], // Japan
    'KR': [33.113, 124.609, 38.612, 131.872], // South Korea
    'KP': [37.673, 124.315, 43.006, 130.675], // North Korea
    'TH': [5.613, 97.343, 20.465, 105.639], // Thailand
    'VN': [8.383, 102.145, 23.393, 109.469], // Vietnam
    'MY': [0.855, 99.644, 7.363, 119.275], // Malaysia
    'PH': [4.588, 116.931, 21.121, 126.604], // Philippines
    'MM': [9.785, 92.189, 28.548, 101.177], // Myanmar
    'KH': [10.409, 102.340, 14.688, 107.628], // Cambodia
    'LA': [13.910, 100.093, 22.503, 107.695], // Laos
    'SG': [1.159, 103.606, 1.471, 104.091], // Singapore
    'BD': [20.743, 88.028, 26.634, 92.673], // Bangladesh
    'PK': [23.787, 60.872, 37.097, 77.837], // Pakistan
    'AF': [29.377, 60.504, 38.483, 74.889], // Afghanistan
    'LK': [5.917, 79.521, 9.835, 81.879], // Sri Lanka
    'NP': [26.347, 80.058, 30.447, 88.201], // Nepal
    'MN': [41.567, 87.749, 52.155, 119.931], // Mongolia
    'KZ': [40.936, 46.493, 55.442, 87.315], // Kazakhstan
    'UZ': [37.184, 55.997, 45.590, 73.132], // Uzbekistan
    'TM': [35.141, 52.335, 42.798, 66.684], // Turkmenistan
    'TJ': [36.674, 67.387, 41.042, 75.137], // Tajikistan
    'KG': [39.173, 69.251, 43.238, 80.283], // Kyrgyzstan
    'IR': [25.064, 44.032, 39.777, 63.333], // Iran
    'IQ': [29.069, 38.795, 37.385, 48.575], // Iraq
    'SY': [32.311, 35.727, 37.319, 42.385], // Syria
    'JO': [29.185, 34.959, 33.375, 39.301], // Jordan
    'IL': [29.497, 34.267, 33.336, 35.896], // Israel
    'PS': [31.353, 34.217, 32.546, 35.573], // Palestine
    'LB': [33.054, 35.104, 34.692, 36.625], // Lebanon
    'SA': [16.379, 34.495, 32.158, 55.667], // Saudi Arabia
    'YE': [12.111, 42.553, 19.000, 54.531], // Yemen
    'OM': [16.645, 51.882, 26.387, 59.836], // Oman
    'AE': [22.633, 51.498, 26.084, 56.382], // UAE
    'QA': [24.482, 50.757, 26.154, 51.636], // Qatar
    'KW': [28.524, 46.555, 30.096, 48.519], // Kuwait
    'BH': [25.796, 50.378, 26.283, 50.820], // Bahrain

    // Americas
    'US': [24.396, -125.001, 49.384, -66.935], // USA (continental)
    'CA': [41.676, -141.003, 83.114, -52.620], // Canada
    'MX': [14.532, -118.404, 32.718, -86.703], // Mexico
    'BR': [-33.751, -73.985, 5.272, -32.392], // Brazil
    'AR': [-55.058, -73.560, -21.781, -53.637], // Argentina
    'CL': [-55.916, -109.456, -17.498, -66.418], // Chile
    'CO': [-4.227, -81.736, 13.390, -66.854], // Colombia
    'PE': [-18.350, -81.411, -0.012, -68.652], // Peru
    'VE': [0.626, -73.378, 12.201, -59.805], // Venezuela
    'EC': [-5.015, -92.008, 1.681, -75.192], // Ecuador
    'BO': [-22.897, -69.641, -9.680, -57.453], // Bolivia
    'PY': [-27.605, -62.647, -19.294, -54.259], // Paraguay
    'UY': [-35.026, -58.443, -30.085, -53.073], // Uruguay
    'CU': [19.828, -84.974, 23.189, -74.131], // Cuba
    'GT': [13.737, -92.236, 17.816, -88.223], // Guatemala
    'HN': [12.983, -89.351, 16.510, -83.147], // Honduras
    'NI': [10.708, -87.690, 15.026, -82.738], // Nicaragua
    'CR': [8.032, -85.951, 11.217, -82.553], // Costa Rica
    'PA': [7.204, -83.052, 9.646, -77.164], // Panama

    // Africa
    'EG': [22.000, 24.698, 31.668, 36.893], // Egypt
    'ZA': [-34.836, 16.458, -22.126, 32.895], // South Africa
    'DZ': [18.976, -8.674, 37.093, 11.997], // Algeria
    'SD': [8.684, 21.827, 22.232, 38.607], // Sudan
    'LY': [19.508, 9.391, 33.169, 25.151], // Libya
    'EH': [20.774, -17.103, 27.667, -8.670], // Western Sahara
    'MA': [27.662, -13.169, 35.922, -0.998], // Morocco
    'TN': [30.240, 7.524, 37.544, 11.598], // Tunisia
    'NG': [4.277, 2.668, 13.892, 14.680], // Nigeria
    'KE': [-4.678, 33.908, 5.506, 41.899], // Kenya
    'ET': [3.397, 32.997, 14.895, 47.986], // Ethiopia
    'GH': [4.737, -3.260, 11.174, 1.191], // Ghana
    'MG': [-25.608, 43.224, -11.945, 50.484], // Madagascar
    'AO': [-18.042, 11.679, -4.388, 24.082], // Angola
    'TZ': [-11.745, 29.340, -0.990, 40.444], // Tanzania
    'UG': [-1.476, 29.573, 4.234, 35.000], // Uganda
    'MZ': [-26.868, 30.217, -10.471, 40.842], // Mozambique
    'CM': [1.655, 8.494, 13.078, 16.192], // Cameroon
    'CI': [4.357, -8.599, 10.740, -2.494], // Ivory Coast
    'ZW': [-22.418, 25.237, -15.608, 33.068], // Zimbabwe
    'SN': [12.307, -17.535, 16.692, -11.356], // Senegal
    'ML': [10.159, -12.242, 25.000, 4.245], // Mali
    'ZM': [-18.079, 21.999, -8.224, 33.706], // Zambia
    'SO': [-1.675, 40.986, 11.979, 51.413], // Somalia
    'TD': [7.442, 13.473, 23.450, 24.000], // Chad
    'MW': [-17.125, 32.673, -9.367, 35.920], // Malawi
    'BF': [9.401, -5.519, 15.084, 2.406], // Burkina Faso
    'NE': [11.693, 0.167, 23.525, 15.996], // Niger

    // Oceania
    'AU': [-43.634, 112.921, -10.062, 153.639], // Australia
    'NZ': [-47.290, 166.426, -34.389, 178.578], // New Zealand
    'PG': [-11.657, 140.842, -0.960, 155.963], // Papua New Guinea
    'FJ': [-20.676, 177.129, -16.021, -179.793], // Fiji
    'NC': [-22.698, 163.564, -19.549, 168.129], // New Caledonia
    'SB': [-11.853, 155.509, -6.590, 166.980], // Solomon Islands
    'VU': [-20.249, 166.524, -13.073, 170.237], // Vanuatu
    'WS': [-14.058, -172.798, -13.432, -171.416], // Samoa
    'PF': [-27.653, -154.717, -7.903, -134.929], // French Polynesia
    'GU': [13.234, 144.619, 13.654, 144.956], // Guam
    'KI': [-11.446, -157.543, 4.720, -150.212], // Kiribati
    'MH': [4.569, 160.798, 14.621, 171.931], // Marshall Islands
    'FM': [1.027, 137.330, 10.089, 163.036], // Micronesia
    'NR': [-0.552, 166.910, -0.504, 166.959], // Nauru
    'PW': [2.748, 131.117, 8.096, 134.722], // Palau
    'TO': [-21.455, -175.682, -15.562, -173.907], // Tonga
    'TV': [-10.801, 176.065, -5.641, 179.863], // Tuvalu

    // Дополнительные страны
    'GE': [41.044, 40.006, 43.586, 46.736], // Georgia
    'AM': [38.841, 43.447, 41.300, 46.634], // Armenia
    'AZ': [38.392, 44.774, 41.911, 50.392], // Azerbaijan
    'CY': [34.633, 32.273, 35.701, 34.597], // Cyprus
    'MT': [35.806, 14.184, 36.082, 14.577], // Malta
    'GL': [59.777, -73.297, 83.627, -11.312], // Greenland
    'AX': [59.809, 19.517, 60.409, 21.012], // Åland Islands
    'FO': [61.394, -7.458, 62.400, -6.257], // Faroe Islands
    'GI': [36.111, -5.366, 36.155, -5.338], // Gibraltar
    'JE': [49.170, -2.254, 49.265, -2.022], // Jersey
    'GG': [49.410, -2.673, 49.731, -2.501], // Guernsey
    'IM': [54.055, -4.798, 54.419, -4.311], // Isle of Man
    'MC': [43.725, 7.409, 43.752, 7.439], // Monaco
    'SM': [43.894, 12.404, 43.992, 12.516], // San Marino
    'VA': [41.900, 12.445, 41.907, 12.458], // Vatican City
    'AD': [42.429, 1.408, 42.656, 1.787], // Andorra
    'LI': [47.048, 9.471, 47.270, 9.636], // Liechtenstein

    // Карибы
    'JM': [17.703, -78.366, 18.525, -76.180], // Jamaica
    'TT': [10.037, -61.931, 11.362, -60.517], // Trinidad and Tobago
    'BS': [20.915, -78.980, 26.919, -72.711], // Bahamas
    'BB': [13.040, -59.649, 13.335, -59.420], // Barbados
    'LC': [13.708, -61.079, 14.110, -60.874], // Saint Lucia
    'GD': [11.986, -61.802, 12.318, -61.376], // Grenada
    'VC': [12.583, -61.460, 13.375, -61.114], // Saint Vincent and the Grenadines
    'AG': [16.997, -61.906, 17.729, -61.672], // Antigua and Barbuda
    'DM': [15.207, -61.484, 15.631, -61.244], // Dominica
    'KN': [17.095, -62.861, 17.420, -62.543], // Saint Kitts and Nevis
    'HT': [18.021, -74.478, 20.088, -71.613], // Haiti
    'DO': [17.470, -72.003, 19.932, -68.320], // Dominican Republic
    'PR': [17.927, -67.271, 18.515, -65.591], // Puerto Rico
    'VG': [18.383, -64.849, 18.757, -64.268], // British Virgin Islands
    'VI': [17.674, -65.085, 18.416, -64.565], // US Virgin Islands
    'AW': [12.406, -70.066, 12.623, -69.866], // Aruba
    'CW': [12.033, -69.157, 12.385, -68.734], // Curaçao
    'SX': [18.010, -63.137, 18.064, -62.971], // Sint Maarten
    'MF': [18.047, -63.152, 18.125, -62.971], // Saint Martin
    'GP': [15.832, -61.809, 16.514, -61.000], // Guadeloupe
    'MQ': [14.394, -61.229, 14.879, -60.809], // Martinique

    // Азия дополнительно
    'BT': [26.702, 88.746, 28.323, 92.125], // Bhutan
    'MV': [-0.693, 72.693, 7.091, 73.637], // Maldives
    'BN': [4.003, 114.095, 5.047, 115.359], // Brunei
    'TL': [-9.464, 124.047, -8.127, 127.308], // East Timor
    'MO': [22.111, 113.529, 22.217, 113.599], // Macau
    'HK': [22.154, 113.837, 22.561, 114.441], // Hong Kong

    // Африка дополнительно
    'BW': [-26.907, 19.999, -17.778, 29.360], // Botswana
    'LS': [-30.668, 27.011, -28.570, 29.455], // Lesotho
    'SZ': [-27.317, 30.794, -25.719, 32.137], // Eswatini
    'NA': [-28.971, 11.716, -16.959, 25.257], // Namibia
    'RW': [-2.840, 28.862, -1.047, 30.899], // Rwanda
    'BI': [-4.466, 29.000, -2.310, 30.848], // Burundi
    'DJ': [10.930, 41.773, 12.707, 43.418], // Djibouti
    'ER': [12.360, 36.438, 18.003, 43.134], // Eritrea
    'GM': [13.061, -16.825, 13.826, -13.798], // Gambia
    'GW': [10.865, -16.717, 12.684, -13.636], // Guinea-Bissau
    'GN': [7.194, -15.130, 12.677, -7.641], // Guinea
    'SL': [6.929, -13.307, 10.000, -10.271], // Sierra Leone
    'LR': [4.353, -11.492, 8.551, -7.365], // Liberia
    'TG': [6.104, -0.147, 11.139, 1.807], // Togo
    'BJ': [6.225, 0.776, 12.408, 3.843], // Benin
    'MR': [14.716, -17.066, 27.298, -4.827], // Mauritania
    'GA': [-3.979, 8.695, 2.326, 14.525], // Gabon
    'CG': [-5.027, 11.093, 3.713, 18.650], // Republic of the Congo
    'CD': [-13.458, 12.204, 5.386, 31.306], // Democratic Republic of the Congo
    'CF': [2.220, 14.420, 11.007, 27.463], // Central African Republic
    'GQ': [-1.475, 5.617, 3.989, 11.335], // Equatorial Guinea
    'ST': [-0.024, 6.470, 1.701, 7.466], // São Tomé and Príncipe
    'CV': [14.808, -25.358, 17.197, -22.657], // Cape Verde
    'KM': [-12.387, 43.220, -11.362, 44.538], // Comoros
    'MU': [-20.526, 56.513, -10.319, 63.500], // Mauritius
    'SC': [-9.753, 46.204, -4.283, 56.297], // Seychelles
    'RE': [-21.389, 55.219, -20.872, 55.838], // Réunion
    'YT': [-13.001, 45.038, -12.637, 45.292], // Mayotte

    // Южная Америка дополнительно
    'SR': [1.831, -58.086, 6.004, -53.977], // Suriname
    'GY': [1.175, -61.384, 8.558, -56.471], // Guyana
    'GF': [2.112, -54.603, 5.776, -51.636], // French Guiana
    'FK': [-52.359, -61.200, -51.238, -57.712], // Falkland Islands
  };

  static String? getCountryCode(double latitude, double longitude) {
    final matches = <String>[];

    for (final entry in bounds.entries) {
      final bbox = entry.value;
      final minLat = bbox[0];
      final minLon = bbox[1];
      final maxLat = bbox[2];
      final maxLon = bbox[3];

      // Check if point is within bounding box
      if (latitude >= minLat &&
          latitude <= maxLat &&
          longitude >= minLon &&
          longitude <= maxLon) {
        matches.add(entry.key);
      }
    }

    // Если нет совпадений
    if (matches.isEmpty) return null;

    // Если одно совпадение - вернуть его
    if (matches.length == 1) return matches.first;

    // Если несколько совпадений - выбираем наиболее вероятный
    // Приоритет: меньший bbox обычно точнее
    String? bestMatch;
    double smallestArea = double.infinity;

    for (final countryCode in matches) {
      final bbox = bounds[countryCode]!;
      final area = (bbox[2] - bbox[0]) * (bbox[3] - bbox[1]);
      if (area < smallestArea) {
        smallestArea = area;
        bestMatch = countryCode;
      }
    }

    return bestMatch;
  }
}
